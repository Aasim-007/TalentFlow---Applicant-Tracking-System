<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Browse Jobs ‚Äî TalentFlow</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg-dark-top:#071428; --bg-dark-bottom:#0b2340; --bg-light-top:#f6f9fc; --bg-light-bottom:#e9f0f6; --card-bg-dark:rgba(255,255,255,0.02); --text-dark:#e9f3ff; --text-light:#0b1220; --muted-dark:#9aa7bb; --muted-light:#5b6b78; --accent1:#60a5fa; --accent2:#6ee7b7; --danger:#e55353; --radius:12px; --shadow:0 12px 30px rgba(2,8,23,0.16); font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; }
    html,body{height:100%;margin:0;padding:0}
    body{ --text:var(--text-dark); --muted:var(--muted-dark); background:linear-gradient(180deg,var(--bg-dark-top) 0%,var(--bg-dark-bottom) 100%); background-attachment:fixed; background-size:cover; min-height:100vh; color:var(--text); padding:26px; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; box-sizing:border-box; transition:background .22s ease,color .18s ease; line-height:1.35; }
    body.theme-light{ --text:var(--text-light); --muted:var(--muted-light); background:linear-gradient(180deg,var(--bg-light-top) 0%,var(--bg-light-bottom) 100%); background-attachment:fixed!important; background-size:cover!important; min-height:100vh!important; }
    body:not(.theme-light){ color-scheme:dark; }
    *{box-sizing:border-box}
    .wrap{ max-width:980px; margin:0 auto; }
    header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:20px; }
    .title{ display:flex; flex-direction:column; gap:4px; }
    .title h1{ margin:0; font-size:26px; font-weight:700; }
    .hint{margin:0;color:var(--muted);font-size:14px}
    .card{ background:color-mix(in srgb,var(--text) 3%,transparent); border-radius:var(--radius); padding:20px; margin-bottom:14px; box-shadow:var(--shadow); border:1px solid rgba(0,0,0,0.03); }
    .theme-control{ display:flex; align-items:center; gap:10px; cursor:pointer; user-select:none; }
    .toggle{ --w:56px; --h:30px; width:var(--w); height:var(--h); border-radius:999px; background:rgba(255,255,255,0.06); display:inline-block; position:relative; padding:0; transition:background .18s ease; }
    .toggle .knob{ position:absolute; top:50%; left:4px; width:22px; height:22px; border-radius:50%; background:#fff; box-shadow:0 6px 16px rgba(2,8,23,0.22); transform:translateY(-50%); transition:left .22s ease,background .22s ease,box-shadow .22s ease; }
    body.theme-light .toggle{ background:rgba(0,0,0,0.08); }
    body.theme-light .toggle .knob{ left:calc(100% - 4px - 22px); background:#111827; }
    .toggle .icon{ width:16px; height:16px; opacity:.85; position:absolute; top:50%; transform:translateY(-50%); pointer-events:none; }
    .toggle .left{ left:10px; }
    .toggle .right{ right:10px; }
    .muted{ color:var(--muted); font-size:13px; }
    .back-btn{ display:inline-flex; align-items:center; gap:8px; padding:8px 14px; border-radius:8px; text-decoration:none; color:var(--text); border:1px solid rgba(96,165,250,0.25); background:linear-gradient(135deg,rgba(96,165,250,0.08),rgba(110,231,183,0.05)); font-weight:600; font-size:14px; transition:all .18s ease; }
    .back-btn:hover{ border-color:rgba(96,165,250,0.45); background:linear-gradient(135deg,rgba(96,165,250,0.14),rgba(110,231,183,0.10)); }
    .job-item{ background:color-mix(in srgb,var(--text) 2%,transparent); border-radius:10px; padding:16px; margin-bottom:10px; border:1px solid rgba(96,165,250,0.15); transition:all .18s ease; cursor:pointer; }
    .job-item:hover{ border-color:rgba(96,165,250,0.35); background:color-mix(in srgb,var(--text) 4%,transparent); transform:translateY(-1px); }
    .job-title{ font-size:18px; font-weight:700; margin:0 0 6px 0; }
    .job-meta{ display:flex; gap:16px; flex-wrap:wrap; margin-top:8px; }
    .job-meta-item{ display:flex; align-items:center; gap:6px; font-size:13px; color:var(--muted); }
    .badge{ display:inline-block; padding:4px 10px; border-radius:6px; font-size:12px; font-weight:600; text-transform:uppercase; }
    .badge.published{ background:linear-gradient(135deg,rgba(110,231,183,0.15),rgba(96,165,250,0.15)); color:var(--accent2); border:1px solid rgba(110,231,183,0.25); }
    .badge.draft{ background:rgba(255,193,7,0.15); color:#ffc107; border:1px solid rgba(255,193,7,0.25); }
    .badge.closed{ background:rgba(229,83,83,0.15); color:var(--danger); border:1px solid rgba(229,83,83,0.25); }
    .loading{ text-align:center; padding:40px 20px; color:var(--muted); }
    .empty{ text-align:center; padding:60px 20px; color:var(--muted); }
    @media (max-width:720px){ body{ padding:14px; } .card{ padding:16px; } .job-meta{ flex-direction:column; gap:8px; } }
  </style>
</head>
<body>
<div class="wrap" role="application">
  <header>
    <div class="title">
      <h1>Browse Jobs</h1>
      <p class="hint">Find and apply for open positions</p>
    </div>
    <div style="display:flex; align-items:center; gap:16px;">
      <div class="theme-control" id="themeControl" role="button" tabindex="0" aria-pressed="false" aria-label="Toggle theme">
        <span id="themeLabel" class="muted">Dark Mode</span>
        <div class="toggle" id="themeToggle" aria-hidden="true">
          <svg class="icon left" viewBox="0 0 24 24" fill="none"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="currentColor"/></svg>
          <div class="knob" id="themeKnob" aria-hidden="true"></div>
          <svg class="icon right" viewBox="0 0 24 24" fill="none"><g fill="currentColor"><circle cx="12" cy="12" r="3.25"/><path d="M12 2v1.8M12 20.2V22M4.93 4.93l1.27 1.27M17.8 17.8l1.27 1.27M2 12h1.8M20.2 12H22M4.93 19.07l1.27-1.27M17.8 6.2l1.27-1.27" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></g></svg>
        </div>
      </div>
      <a class="back-btn" href="/applicant-landing/index.html">
        <span>‚Üê</span>
        <span>Back</span>
      </a>
    </div>
  </header>

  <main>
    <section class="card">
      <h2 style="margin:0 0 8px 0;font-size:20px;font-weight:600;">Available Positions</h2>
      <p class="muted" style="margin:0 0 16px 0;">Click on any job to view details and apply.</p>

      <div id="jobsList"></div>
    </section>
  </main>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const body = document.body;
  const themeControl = document.getElementById('themeControl');
  const themeLabel = document.getElementById('themeLabel');
  const jobsList = document.getElementById('jobsList');

  // Theme management
  const THEME_KEY = 'talentflow_theme';
  function applyTheme(t){
    if(t === 'light') body.classList.add('theme-light'); else body.classList.remove('theme-light');
    themeLabel.textContent = (t === 'light') ? 'Light Mode' : 'Dark Mode';
    if(themeControl) themeControl.setAttribute('aria-pressed', t === 'light' ? 'true' : 'false');
    body.style.backgroundAttachment = 'fixed';
    body.style.minHeight = '100vh';
    body.style.backgroundSize = 'cover';
  }
  const savedTheme = (function(){ try { return localStorage.getItem(THEME_KEY) || 'dark'; } catch(e){ return 'dark'; } })();
  applyTheme(savedTheme);
  function toggleTheme(){
    const cur = body.classList.contains('theme-light') ? 'light' : 'dark';
    const next = cur === 'light' ? 'dark' : 'light';
    applyTheme(next);
    try{ localStorage.setItem(THEME_KEY, next); } catch(e){}
  }
  themeControl.addEventListener('click', toggleTheme);
  themeControl.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleTheme(); } });

  // Fetch and display jobs
  async function loadJobs() {
    jobsList.innerHTML = '<div class="loading">Loading jobs...</div>';

    try {
      const res = await fetch('/api/jobs');
      if (!res.ok) throw new Error('Failed to fetch jobs');

      const jobs = await res.json();

      // Filter only published jobs
      const publishedJobs = jobs.filter(job => job.status === 'published');

      if (publishedJobs.length === 0) {
        jobsList.innerHTML = '<div class="empty">No jobs available at the moment. Check back later!</div>';
        return;
      }

      jobsList.innerHTML = publishedJobs.map(job => `
        <div class="job-item" onclick="viewJob(${job.id})">
          <h3 class="job-title">${escapeHtml(job.title || 'Untitled Job')}</h3>
          <div class="job-meta">
            ${job.department ? `<div class="job-meta-item"><span>üè¢</span><span>${escapeHtml(job.department)}</span></div>` : ''}
            ${job.location ? `<div class="job-meta-item"><span>üìç</span><span>${escapeHtml(job.location)}</span></div>` : ''}
            ${job.employmentType ? `<div class="job-meta-item"><span>üíº</span><span>${formatEmploymentType(job.employmentType)}</span></div>` : ''}
            ${job.applicationDeadline ? `<div class="job-meta-item"><span>üìÖ</span><span>Apply by ${formatDate(job.applicationDeadline)}</span></div>` : ''}
          </div>
          <div style="margin-top:10px;">
            <span class="badge ${job.status}">${job.status}</span>
          </div>
        </div>
      `).join('');

    } catch (e) {
      console.error('Error loading jobs:', e);
      jobsList.innerHTML = '<div class="empty">Failed to load jobs. Please try again later.</div>';
    }
  }

  window.viewJob = function(jobId) {
    window.location.href = `/apply/apply.html?jobId=${jobId}`;
  };

  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":String.fromCharCode(39)}[c])); }

  function formatEmploymentType(type) {
    const map = {
      'full_time': 'Full Time',
      'part_time': 'Part Time',
      'contract': 'Contract',
      'internship': 'Internship'
    };
    return map[type] || type;
  }

  function formatDate(dateStr) {
    try {
      const d = new Date(dateStr);
      return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    } catch(e) {
      return dateStr;
    }
  }

  loadJobs();
});
</script>
</body>
</html>

